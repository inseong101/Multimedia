let player;
function onYouTubeIframeAPIReady() {
  const container = document.querySelector(".video-container");
  const videoId = container.dataset.videoId;
  const start = parseInt(container.dataset.start);
  const end = parseInt(container.dataset.end);
  const playerDiv = container.querySelector(".player");
  const mask = container.querySelector(".player-mask");

  player = new YT.Player(playerDiv, {
    videoId: videoId,
    playerVars: {
      autoplay: 1,
      controls: 1,
      mute: 1,
      start: start,
      end: end,
      rel: 0,
      modestbranding: 1,
      enablejsapi: 1,
    },
    events: {
      onReady: (e) => {
        e.target.playVideo();
        setTimeout(() => mask.style.display = "none", 1000);
      },
      onStateChange: (e) => {
        if (e.data === YT.PlayerState.PLAYING) {
          const interval = setInterval(() => {
            if (player.getCurrentTime && player.getCurrentTime() >= end - 1) {
              clearInterval(interval);
              mask.style.display = "flex";
            }
          }, 500);
        }
      }
    }
  });

  document.querySelector(".replay-button").addEventListener("click", () => {
    mask.style.display = "flex";
    player.seekTo(start);
    setTimeout(() => mask.style.display = "none", 1000);
  });

  document.querySelector(".unmute-button").addEventListener("click", () => {
    player.unMute();
  });
}

